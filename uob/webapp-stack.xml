version: "3.2"
secrets:
  cert0.pem:
    file: cert0.pem

services:
  haproxy:
    image: uobhaproxy
    ports:
      - target: 80
        published: 80
        mode: host
      - target: 443
        published: 443
        mode: host
      - target: 1936
        published: 1936
        mode: host
    volumes:
      - type: bind
        target: "/var/run/docker.sock"
        source: "/var/run/docker.sock"
    secrets:
      - cert0.pem
    environment:
      CERT_FOLDER: "/run/secrets/"
      
  tomcat:
    image: tomcat
    environment:
      SERVICE_PORTS: "8080"
      VIRTUAL_HOST: "http://*,https://*"
      FORCE_SSL: "true"

  tomcat2:
    image: tomcat
    environment:
      SERVICE_PORTS: "8080"
      VIRTUAL_HOST: "http://foo.com,https://foo.com"
      FORCE_SSL: "true"
      PROXY_NAME: "foo.com"